[include fluidd.cfg]
[include macros/macros.cfg]
[mcu]
serial: /dev/serial/by-id/usb-Klipper_lpc1769_03D00007A39869AF1841405EC72000F5-if00

[printer]
kinematics: cartesian
max_velocity: 150
max_accel: 2500
max_accel_to_decel: 1200
max_z_velocity: 20
max_z_accel: 100

[stepper_x]
step_pin: P2.2
dir_pin: P2.6
enable_pin: !P2.1
#endstop_pin: P1.29
endstop_pin: tmc2209_stepper_x:virtual_endstop
homing_retract_dist: 0
microsteps: 16
rotation_distance: 40
position_min: 0 #-1.2                                                              # home offset, measure yours or disable for no offset
position_endstop: 0 #-1.2                                                          # home offset, measure yours or set '0' for no offset
position_max: 255
homing_speed: 50
second_homing_speed: 8

[tmc2209 stepper_x]
uart_pin: P1.10
diag_pin: P1.29
#run_current: 1.4
#hold_current: 0.950
run_current: 1.3
hold_current: 1
stealthchop_threshold: 999999
stealthchop_threshold: 1
driver_SGTHRS: 100


[stepper_y]
step_pin: P0.19
dir_pin: P0.20
enable_pin: !P2.8
endstop_pin: tmc2209_stepper_y:virtual_endstop
microsteps: 16
rotation_distance: 40
position_min: -8.3                                                            # home offset, measure yours or disable for no offset
position_endstop: -8.3
position_max: 210
homing_speed: 50
second_homing_speed: 8
homing_retract_dist: 0

[tmc2209 stepper_y]
uart_pin: P1.9
diag_pin: P1.28
#run_current: 1.4
#hold_current: 0.950
stealthchop_threshold: 999999
run_current: 1.2
hold_current: 1
driver_SGTHRS: 100

[stepper_z]
step_pin: P0.22
dir_pin: !P2.11
enable_pin: !P0.21
endstop_pin: ~P1.27
microsteps: 16
rotation_distance: 8
position_endstop: 0.2
position_max: 200
homing_speed: 5
homing_retract_speed: 2
homing_retract_dist: 1
second_homing_speed: 0.5

[tmc2209 stepper_z]
uart_pin: P1.8
#run_current: 0.650
#hold_current: 0.450
#stealthchop_threshold: 500
run_current: 0.650
hold_current: 0.460
stealthchop_threshold: 999999

[safe_z_home]
home_xy_position: 106.4,159
z_hop: 10                 # Move up 10mm
z_hop_speed: 5

[heater_bed]
heater_pin: P2.5
sensor_pin: P0.25
sensor_type: EPCOS 100K B57560G104F
min_temp: 0
max_temp: 130
#control = pid
#pid_kp = 63.125
#pid_ki = 1.163
#pid_kd = 856.929

[extruder]
step_pin: P2.13
dir_pin: P0.11
enable_pin: !P2.12
full_steps_per_rotation: 400
rotation_distance: 9.142
microsteps: 16
nozzle_diameter: 0.400
filament_diameter: 1.750
max_extrude_only_distance: 9999999                                          # ~100 direct, ~600 bowden
heater_pin: P2.7
sensor_type: EPCOS 100K B57560G104F
sensor_pin: P0.24
min_temp: 0
max_temp: 310
pressure_advance = 0
control = pid
pid_kp = 33.964
pid_ki = 2.866
pid_kd = 100.619

[tmc2209 extruder]
uart_pin: P1.4
run_current: 0.35
hold_current: 0.2
stealthchop_threshold: 0
sense_resistor: 0.110

[heater_fan extruder_fan]
pin: P2.4
heater_temp: 50.0

[fan]
pin: P2.3
kick_start_time: 0.500

[bed_screws]
screw1: 25,30
screw1_name: front left screw
screw2: 230,30
screw2_name: front right screw
screw3: 230,180
screw3_name: back right screw
screw4: 25,180
screw4_name: back left screw
speed: 150

[bed_screws]
screw5: 127.5,105
screw5_name: center virtual screw

[firmware_retraction]
retract_speed: 30
unretract_speed: 30

[output_pin _BEEPER_pin]
pin: P1.18
pwm: True
value: 0
shutdown_value: 0
cycle_time: 0.0024

[bed_mesh]
speed: 120
horizontal_move_z: 1
mesh_min: 35, 6
mesh_max: 230, 190
probe_count: 5, 3

[bltouch]
sensor_pin: P0.10 #Probe
control_pin: P2.0 #SERVOS
x_offset: 20
y_offset: -52
z_offset: 0.2

[input_shaper]


[respond]

[gcode_macro HIGH_SPEED]
gcode:
    SET_TMC_CURRENT STEPPER=stepper_x CURRENT=1.000 HOLDCURRENT=0.750
    SET_TMC_CURRENT STEPPER=stepper_y CURRENT=1.000 HOLDCURRENT=0.750
    #SET_TMC_CURRENT STEPPER=extruder CURRENT=0.600 HOLDCURRENT=0.300
    
[gcode_macro NORMAL_SPEED]
gcode:
    {% set tmc_x = printer.configfile.settings["tmc2209 stepper_x"] %}
    {% set tmc_y = printer.configfile.settings["tmc2209 stepper_y"] %}
    {% set tmc_e = printer.configfile.settings["tmc2209 extruder"] %}
    SET_TMC_CURRENT STEPPER=stepper_x CURRENT={tmc_x.run_current} HOLDCURRENT={tmc_x.hold_current}
    SET_TMC_CURRENT STEPPER=stepper_y CURRENT={tmc_y.run_current} HOLDCURRENT={tmc_y.hold_current}
    #SET_TMC_CURRENT STEPPER=extruder CURRENT={tmc_e.run_current} HOLDCURRENT={tmc_e.hold_current}

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 50.145
#*# pid_ki = 1.827
#*# pid_kd = 344.122
#*#
#*# [bed_mesh Main]
#*# version = 1
#*# points =
#*# 	  0.350000, 0.395000, 0.375000, 0.320000, 0.285000
#*# 	  0.290000, 0.275000, 0.260000, 0.200000, 0.190000
#*# 	  0.110000, 0.115000, 0.110000, 0.135000, 0.135000
#*# x_count = 5
#*# y_count = 3
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = lagrange
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 230.0
#*# min_y = 6.0
#*# max_y = 190.0
